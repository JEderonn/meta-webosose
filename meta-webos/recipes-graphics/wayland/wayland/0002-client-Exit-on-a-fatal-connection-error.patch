From 33b19050622db5269ff3e8dd8ed6a5ce49de38e4 Mon Sep 17 00:00:00 2001
From: Jaeyoon Jung <jaeyoon.jung@lge.com>
Date: Mon, 13 Aug 2018 14:29:34 +0900
Subject: [PATCH] client: Exit on a fatal connection error

Terminate a client if there is an error such as EPIPE or ECONNRESET.
This is a safe method for a client that does not handle a fatal
connection error properly, but not recommended for the upstream as
ideally a client should be able to decide what to do on a broken
connection.

Signed-off-by: Jaeyoon Jung <jaeyoon.jung@lge.com>

Upstream-Status: Inappropriate [webOS specific]
---
 src/wayland-client.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/wayland-client.c b/src/wayland-client.c
index b0805f1..49b7df5 100644
--- a/src/wayland-client.c
+++ b/src/wayland-client.c
@@ -152,6 +152,13 @@ display_fatal_error(struct wl_display *display, int error)
 	display->last_error = error;
 
 	display_wakeup_threads(display);
+
+	if (error == EPIPE || error == ECONNRESET) {
+		wl_log("Exit client due to a fatal connection failure: %s\n",
+				strerror(error));
+		pthread_mutex_unlock(&display->mutex);
+		exit(1);
+	}
 }
 
 /**
